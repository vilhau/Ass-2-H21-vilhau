---
title: "Ass_2"
author: "Christoffersen J. & Haugland V."
date: "Oktober 14. 2021"
output:
  pdf_document: default
  html_notebook: default
---

# Del 1 - Innledning

## Kort innledning

## Kort litteraturgjennomgang på ca. 1 side

```{r}
library(modelr)
library(dplyr)
library(ggplot2)
```

```{r}
# Endrer navn på datasettet fra heights til hoyde
data("heights", package = "modelr")
hoyde <- heights
```

## Beskrivende statistikk

I datasettet hoyde har vi $n=7006$, som vil si at settet består av totalt 7006 ulike observasjoner. Videre har vi de 7 uavhengige variabelene *høyde*, *vekt*, *alder*, *sivilstatus*, *kjønn*, *utdannelse* og *afqt* (Score fra forvarets kvalifiseringstest), som bestemmer den avhengige variablen *inntekt* i dette settet. Hvorav variablene *sivilstatus* og *kjønn* er såkalte dummyvariabler. *Sivilstatus* varier med fem ulike faktorer som er *singel*, *gift*, *separert*, *skilt* og *enke* og dummyvariablen *kjønn* varier mellom tallet 1 og 2 som bestemmer om individet som er observert er enten mann eller kvinne.

## EDA

- **Histogram**

```{r}
hist(hoyde$income, breaks = 100)
```

- **Forklaring på utliggerne langt til høyre**

For å forklare utliggerne langt til høyere, kan vi begynne med å finne ut hva maksimumsverdien av variablen *income* er.

```{r}
summary(hoyde)
```

Fra summeringstabellen ser vi at maksimumsverdien til variablen *income* er 343,830. Videre kan vi undersøke hvor mange av de observerte som innehar denne verdien.

```{r}
sum(hoyde$income == 343830)
```

Totalt var det 7006 observasjoner og med hensyn til at 143 hadde maksimumsverdien og at det er en relativt stor avstand mellom maksinntekten og medianen til datasettet, kan vi si at utliggerne til høyere representerer ca. 2% av det totale utvalget.

```{r}
(143/7006)*100
```

- **Har vi med personer uten inntekt i datasettet?**

Ja. Datasettet inneholder observasjoner av en rekke individer uten inntekt. Dette kan vi enkelt observere ved å se på histogrammet på 0 langs x-aksen, hvor vi ser at frekvensen på denne verdien er $<1500$. Vi kan også benytte summeringstabellen fra tidligere og se på minimumsverdien til variablen *income* som er på 0. Dersom vi ønsker å finne ut hvor mange av de observerte som innehar denne verdien, kan vi benytte følgende:

```{r}
sum(hoyde$income == 0)
```

# Del 2 - Regresjonsanalyse

## Redusere datasettet

Med henhold til at vi har funnet ut at datasettet inneholder mange minimumsverdier på 0 og at maksimumsverdien på 343,830 utgjorde kun 2% av utvalget, skal vi fjerne disse verdiene for å kunne kjøre en endelig modell mot reduserte datasett. Dette gjør vi for å teste modellens robushet. 

```{r}
sample1=filter(hoyde,income!=0 & income!=343830)
```

Her har vi opprettet en ny model, under navnet *sample1*. For å sjekke om de riktige verdiene ble fjernet kan vi kjøre en ny summeringstabell.

```{r}
summary(sample1)
```

Her kan vi se at både minimums- og makismumsverdien har endret seg. Det nye datasettet inneholder også færre observasjoner:
$$7006-143-1740=5123$$
Ny $n=5123$ til datasettet *sample1*.

## Mutering av eksisterende variabler fra imperial- til metric system

Siden vi benytter oss av det metriske systemet i Norge og datasettet har brukt det imperiske, så ønsker vi å endre disse variablene. Variablene dette omhandler er *height* og *weight* som vi skal gjøre om til *height_cm* og *weight_kg*. Har funnet ut på nettet at en inch er 2.54 cm og en pund er ca. 0.45 kg.

```{r}
hoyde <- hoyde %>%
  mutate(height_cm = height * 2.54)
```

- **Vi kan teste om muteringen av *height* fungerer ved å:**

```{r}
# Finne maksverdien av den nye variablen
max(hoyde$height_cm)
```

```{r}
# Vi kan sjekke at dette stemmer ved å se hva den høyeste i inches er
max(hoyde$height)
```

```{r}
# Og så gange med 2.54 som var overgangen fra inches til cm
84*2.54
```

```{r}
# Bruker samme fremgangsmåte for pund til kg
hoyde <- hoyde %>%
  mutate(weight_kg = weight *0.45)
```

Fra summeringstabellen til datasettet *hoyde* kan vi se at variablen *weight* har flere NA-verdier, altså verdier som ikke er tilgjengelige. Dersom man ønsker å finne ut hva for eksempel maksimumsverdien til *weight_kg* er må man skrive følgende:

```{r}
max(hoyde$weight_kg, na.rm = TRUE)
```

Vi putter inn $na.rm = TRUE$ slik at R utelater cellene med betegnelsen *NA* (Not available). Dette gjør at vi kun får cellene med tallverdier.

Dersom man ønsker å finne ut om andre variabler også innehar verdier som er NA, kan vi skrive:

```{r}
# For å sjekke hvilke celler som har NA
colSums(is.na(hoyde))
```

## Opprettelse av ny variabel BMI

```{r}
hoyde <- hoyde %>%
  mutate(hoyde, bmi = weight_kg/(height_cm)^2)
```

## Forenklet utgave av variablen martial

Siden dummyvariabel *marital* innholdt hele 5 ulike faktorer, så ønsker vi å forenkle denne til enten "True" eller "False" for om individet er gift eller ikke-gift. 

```{r}
hoyde <- hoyde %>%
  mutate(
    married = factor(
      case_when(
        marital == "married" ~ TRUE,
        TRUE ~ FALSE
      )
    )
  )
```

# Del 3 - Estimere modeller


```{r}
lm1 <- lm(income ~ height_cm, data = hoyde )
lm2 <- lm(income ~ height_cm + weight_kg + education, data = hoyde)
lm3 <- lm(income ~ height_cm + sex + age + education, data = hoyde)
```

```{r}
summary(lm2)
```

```{r}
library(huxtable)
```

## Redusert datasett


```{r}
# Legge til height_cm i redusert datasett (sample1)
sample1 <- sample1 %>%
  mutate(height_cm = height * 2.54)
```

```{r}
# Legge til weight_kg i redusert datasett (sample1)
sample1 <- sample1 %>%
  mutate(weight_kg = weight *0.45)
```

```{r}
# Legge til bmi i sample1
sample1 <- sample1 %>%
  mutate(sample1, bmi = weight_kg/(height_cm)^2)
```

```{r}
# Legge til forenklet utgave av marrital i sample1
sample1 <- sample1 %>%
  mutate(
    married = factor(
      case_when(
        marital == "married" ~ TRUE,
        TRUE ~ FALSE
      )
    )
  )
```


```{r}
lm4 <- lm(income ~ height_cm, data = sample1)
lm5 <- lm(income ~ height_cm + weight_kg + education, data = sample1)
lm6 <- lm(income ~ height_cm + sex + age + education, data = sample1)
```

```{r}
summary(lm5)
```


