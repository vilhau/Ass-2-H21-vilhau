---
title: "Ass_2"
author: "Christoffersen J. & Haugland V."
date: "Oktober 14. 2021"
output:
  pdf_document: default
  html_notebook: default
lang: no-NB
---

# Del 1 - Innledning

Bare en liten test.

## Kort innledning

## Kort litteraturgjennomgang på ca. 1 side

```{r setup}
library(modelr)
library(dplyr)
library(ggplot2)
library(tinytex)
library(tidyverse)
library(ggpubr)
library(huxtable)
options(scipen = 999)
```

## Analyse

Vi lager først et histogram med inntekts-variabel. 

```{r}
# Endrer navn på datasettet fra heights til hoyde
data("heights", package = "modelr")
hoyde <- heights
```

## Beskrivende statistikk

I datasettet hoyde har vi $n=7006$, som vil si at settet består av totalt 7006 ulike observasjoner. Videre har vi de 7 uavhengige variabelene *høyde*, *vekt*, *alder*, *sivilstatus*, *kjønn*, *utdannelse* og *afqt* (Score fra forvarets kvalifiseringstest), som bestemmer den avhengige variablen *inntekt* i dette settet. Hvorav variablene *sivilstatus* og *kjønn* er såkalte dummyvariabler. *Sivilstatus* varier med fem ulike faktorer som er *singel*, *gift*, *separert*, *skilt* og *enke* og dummyvariablen *kjønn* varier mellom tallet 1 og 2 som bestemmer om individet som er observert er enten mann eller kvinne.

## EDA

- **Histogram til variabelen innekt**
Til å begynne med lages tre nye variabler som settes til en metrisk standard.

```{r}
hoyde <- hoyde %>%
  mutate(inntekt = income * 8.42,
         hoyde_cm = height * 2.54,
         vekt_kg = weight * 0.454,
         BMI = vekt_kg / (hoyde_cm/100)^2)
```


```{r}
ggplot(data = hoyde, aes(x = inntekt)) + 
  geom_histogram()
  geom_histogram(bins = 30)
  
```

- **Forklaring på utliggerne langt til høyre**

Utliggeren til høyre viser gjennomsnittet av 2% topp inntekt.
For å forklare dette bedre kan vi begynne med å finne maksimumsverdien av variablen *inntekt*.

```{r}
summary(hoyde)
```

Fra summeringstabellen ser vi at maksimumsverdien til variablen *inntekt* er 343,830. Videre kan vi undersøke hvor mange av observasjonene
som innehar denne verdien.

```{r}
sum(hoyde$income == 343830)
```

Totalt var det 7006 observasjoner og med hensyn til at 143 hadde maksimumsverdien og at det er en relativt stor avstand mellom maksinntekten og medianen til datasettet, kan vi si at utliggerne til høyere representerer et gjennomsnitt av ca. 2% av det totale utvalget.

```{r}
(143/7006)*100
```

Dersom datasettet reduseres for topp 2% høyeste inntekt og inntekt lik 0, ser histogrammet slik ut:

```{r}
hoyde_begr <- hoyde %>%
  filter(inntekt < 1500000,
         inntekt > 1)
```

```{r}
ggplot(data = hoyde_begr, aes(x = inntekt)) + 
  geom_histogram()
```

- **Har vi med personer uten inntekt i datasettet?**

Ja. Datasettet inneholder observasjoner av en rekke individer uten inntekt. Dette fremkommer av histogrammet til variabelen inntekt hvor $<1500$ er frekvensen til 0 langs x-aksen.
Det fremkommer også av hoyde-summeringstabellen at minimumsverdien til inntekt-variabelen er 0.
Dersom vi ønsker å finne ut hvor mange av de observerte som innehar denne verdien, kan vi benytte følgende:

```{r}
sum(hoyde$income == 0)
```

# Del 2 - Regresjonsanalyse

```{r}
mod1 <- "inntekt ~ hoyde_cm"
lm1 <- lm(mod1, data = hoyde, subset = complete.cases(hoyde))
```

```{r}
summary (lm1)
```

Her ser man at inntekt øker med 10047.9 kr dersom høyde øker med 1 cm. 
Test:

```{r}
-1361001.0 + (10047.9 * 173)
-1361001.0 + (10047.9 * 161)
```

```{r}
mod2 <- "inntekt ~ hoyde_cm + vekt_kg"
lm2 <- lm(mod2, data = hoyde, subset = complete.cases(hoyde))
```


```{r}
summary(lm2)
```

Fra regresjonsanalysen over ser man inntekt øker ved økt høyde, men synker ved økning i vekt. Dersom høyde økes med 1 cm og vekt samtidig øker med 1 kg, vil også inntekten øke. Dette skyldes at inntekten øker betydelig mer ved økning i høyde, enn den syker ved tilsvarende økning i vekt.

```{r}
mod3 <- "inntekt ~ hoyde_cm + vekt_kg + BMI"
lm3 <- lm(mod3, data = hoyde, subset = complete.cases(hoyde))
```

```{r}
summary(lm3)
```

Videre fremkommer det at en kombinasjon av økning i høyde, vekt og BMI, også vil gi en økning i innekt.


............................................
## Redusere datasettet

Med henhold til at vi har funnet ut at datasettet inneholder mange minimumsverdier på 0 og at maksimumsverdien på 343,830 utgjorde kun 2% av utvalget, skal vi fjerne disse verdiene for å kunne kjøre en endelig modell mot reduserte datasett. Dette gjør vi for å teste modellens robushet. 

```{r}
sample1=filter(hoyde,income!=0 & income!=343830)
```

Her har vi opprettet en ny model, under navnet *sample1*. For å sjekke om de riktige verdiene ble fjernet kan vi kjøre en ny summeringstabell.

```{r}
summary(sample1)
```

Her kan vi se at både minimums- og makismumsverdien har endret seg. Det nye datasettet inneholder også færre observasjoner:
$$7006-143-1740=5123$$
Ny $n=5123$ til datasettet *sample1*.

## Mutering av eksisterende variabler fra imperial- til metric system

Siden vi benytter oss av det metriske systemet i Norge og datasettet har brukt det imperiske, så ønsker vi å endre disse variablene. Variablene dette omhandler er *height* og *weight* som vi skal gjøre om til *height_cm* og *weight_kg*. Har funnet ut på nettet at en inch er 2.54 cm og en pund er ca. 0.45 kg.

```{r}
hoyde <- hoyde %>%
  mutate(height_cm = height * 2.54)
```

- **Vi kan teste om muteringen av *height* fungerer ved å:**

```{r}
# Finne maksverdien av den nye variablen
max(hoyde$height_cm)
```

```{r}
# Vi kan sjekke at dette stemmer ved å se hva den høyeste i inches er
max(hoyde$height)
```

```{r}
# Og så gange med 2.54 som var overgangen fra inches til cm
84*2.54
```

```{r}
# Bruker samme fremgangsmåte for pund til kg
hoyde <- hoyde %>%
  mutate(weight_kg = weight *0.45)
```

Fra summeringstabellen til datasettet *hoyde* kan vi se at variablen *weight* har flere NA-verdier, altså verdier som ikke er tilgjengelige. Dersom man ønsker å finne ut hva for eksempel maksimumsverdien til *weight_kg* er må man skrive følgende:

```{r}
max(hoyde$weight_kg, na.rm = TRUE)
```

Vi putter inn $na.rm = TRUE$ slik at R utelater cellene med betegnelsen *NA* (Not available). Dette gjør at vi kun får cellene med tallverdier.

Dersom man ønsker å finne ut om andre variabler også innehar verdier som er NA, kan vi skrive:

```{r}
# For å sjekke hvilke celler som har NA
colSums(is.na(hoyde))
```
......................



## Opprettelse av ny variabel BMI

```{r}
hoyde <- hoyde %>%
  mutate(hoyde, bmi = weight_kg/(height_cm)^2)
```

## Forenklet utgave av variablen martial

Siden dummyvariabel *marital* innholdt hele 5 ulike faktorer, så ønsker vi å forenkle denne til enten "True" eller "False" for om individet er gift eller ikke-gift. 

```{r}
hoyde <- hoyde %>%
  mutate(
    married = factor(
      case_when(
        marital == "married" ~ TRUE,
        TRUE ~ FALSE
      )
    )
  )
```

# Del 3 - Estimere modeller


```{r}
lm1 <- lm(income ~ height_cm, data = hoyde, subset = complete.cases(hoyde))
lm2 <- lm(income ~ height_cm + weight_kg + education, data = hoyde, subset = complete.cases(hoyde))
lm3 <- lm(income ~ height_cm + sex + age + education, data = hoyde, subset = complete.cases(hoyde))
```

## Test interaksjon

```{r}
m_educsex_i <- "income ~ education*sex"
lm_educsex_i <- lm(m_educsex_i, data = hoyde)
```

```{r}
summary(lm_educsex_i)
```

```{r}
summary(lm2)
```

```{r}
library(huxtable)
```

```{r}
huxreg(lm1, lm2, lm3)
```

## Redusert datasett


```{r}
# Legge til height_cm i redusert datasett (sample1)
sample1 <- sample1 %>%
  mutate(height_cm = height * 2.54)
```

```{r}
# Legge til weight_kg i redusert datasett (sample1)
sample1 <- sample1 %>%
  mutate(weight_kg = weight *0.45)
```

```{r}
# Legge til bmi i sample1
sample1 <- sample1 %>%
  mutate(sample1, bmi = weight_kg/(height_cm)^2)
```

```{r}
# Legge til forenklet utgave av marrital i sample1
sample1 <- sample1 %>%
  mutate(
    married = factor(
      case_when(
        marital == "married" ~ TRUE,
        TRUE ~ FALSE
      )
    )
  )
```


```{r}
lm4 <- lm(income ~ height_cm, data = sample1, subset = complete.cases(hoyde))
lm5 <- lm(income ~ height_cm + weight_kg + education, data = sample1, subset = complete.cases(hoyde))
lm6 <- lm(income ~ height_cm + sex + age + education, data = sample1, subset = complete.cases(hoyde))
```

```{r}
summary(lm5)
```

```{r}
huxreg(lm4, lm5, lm6)
```

```{r}
huxreg(
  list("Modell 1" = lm1, "Modell 4" = lm4),
  error_format = "[{statistic}]",
  note = "Regresjonstabell 1: {stars}. T statistics in brackets."
)
```

```{r}
huxreg(
  list("Modell 2" = lm2, "Modell 5" = lm5),
  error_format = "[{statistic}]",
  note = "Regresjonstabell 2: {stars}. T statistics in brackets."
)
```

```{r}
huxreg(
  list("Modell 3" = lm3, "Modell 6" = lm6),
  error_format = "[{statistic}]",
  note = "Regresjonstabell 3: {stars}. T statistics in brackets."
)
```

## Interaksjon på redusert datasett

```{r}
m_educsex_i <- "income ~ education*sex"
lm_educsex_iI <- lm(m_educsex_i, data = sample1)
```

```{r}
summary(lm_educsex_iI)
```

```{r}
library(car)
```

```{r}
summary(lm6)
```



